<!-- top-bar.html -->
<style>
  :root {
    --accent: #00ffc8;
    --accent-2: #00ffe5;
    --bg: #111;
    --ink: #fff;
  }

  .top-bar {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: var(--bg);
    color: var(--ink);
    border-bottom: 2px solid var(--accent);
    box-shadow: 0 2px 8px rgba(0, 255, 200, 0.3);
  }

  .top-bar-inner {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 0.75rem;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0.6rem 1rem;
    min-height: 56px;
  }

  .visually-hidden {
    position: absolute !important;
    height: 1px; width: 1px;
    overflow: hidden;
    clip: rect(1px,1px,1px,1px);
    white-space: nowrap; border: 0; padding: 0; margin: -1px;
  }

  .logo {
    font-size: clamp(1rem, 1.2vw + 0.8rem, 1.25rem);
    font-weight: 800;
    display: inline-flex; align-items: center; gap: 0.5rem;
    color: var(--accent);
    text-decoration: none;
    letter-spacing: .2px;
    transition: transform .15s ease, text-shadow .15s ease;
  }
  .logo:hover, .logo:focus-visible {
    transform: translateY(-1px);
    text-shadow: 0 0 8px var(--accent);
    outline: none;
  }

  .search {
    display: flex; justify-content: center; align-items: center;
  }
  .search input {
    width: 100%; max-width: 420px;
    padding: 0.55rem 0.8rem;
    border-radius: 8px;
    border: 2px solid var(--accent);
    background: #000; color: var(--ink);
    font-size: 0.95rem;
    transition: border-color .15s ease, box-shadow .15s ease;
  }
  .search input:focus {
    outline: none;
    border-color: var(--accent-2);
    box-shadow: 0 0 10px var(--accent-2);
  }

  .right-side {
    display: inline-flex; align-items: center; gap: 0.75rem;
  }

  .session-info {
    font-size: 0.85rem; color: #ccc;
    max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  .post-btn a {
    display: inline-flex; align-items: center; gap: 0.5rem;
    background: var(--accent); color: #000;
    font-weight: 800; letter-spacing: .2px;
    padding: 0.55rem 0.9rem;
    border-radius: 10px;
    text-decoration: none;
    border: 2px solid transparent;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .post-btn a:hover {
    transform: translateY(-1px);
    box-shadow: 0 0 10px var(--accent);
  }
  .post-btn a:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px #002b24, 0 0 0 5px var(--accent);
  }

  /* Mobile: search full-width row, tighter right cluster */
  @media (max-width: 720px) {
    .top-bar-inner {
      grid-template-columns: 1fr auto;
      grid-template-areas:
        "logo  cta"
        "search search";
      row-gap: 0.5rem;
    }
    .logo { grid-area: logo; }
    .search { grid-area: search; }
    .right-side { grid-area: cta; gap: 0.5rem; }
    .session-info { display: none; } /* hide on tight screens; optional */
    .post-btn a { padding: 0.5rem 0.7rem; }
  }

  @media (prefers-reduced-motion: reduce) {
    .logo, .post-btn a { transition: none; }
    .search input { transition: none; }
  }
</style>

<header class="top-bar" role="banner">
  <div class="top-bar-inner">
    <a href="/" class="logo" aria-label="TimeShareZ Home">
      ⏳ <span>TimeShareZ</span>
    </a>

    <form class="search" role="search" aria-label="Project Search">
      <label for="project-search" class="visually-hidden">Search Projects</label>
      <input id="project-search" type="search" name="q" placeholder="Search projects…" aria-label="Search projects" />
    </form>

    <div class="right-side">
      <div class="session-info" id="sessionDisplay">Loading session…</div>
      <div class="post-btn">
        <a href="/post-project" aria-label="Post a new project">
          <span aria-hidden="true">＋</span><span>Post Project</span>
        </a>
      </div>
    </div>
  </div>
</header>

<script>
(() => {
  // Prevent form submission reload; hook up your own search handler as needed
  const searchForm = document.querySelector('.search');
  if (searchForm) {
    searchForm.addEventListener('submit', (e) => e.preventDefault());
  }

  const displayEl = document.getElementById("sessionDisplay");
  if (!displayEl) return;

  // Prefer existing cached number if present to avoid flicker
  const cachedNum = localStorage.getItem("session_number");
  if (cachedNum) displayEl.textContent = `Session: ${cachedNum}`;

  const sessionId = localStorage.getItem("session_id");
  if (!sessionId) {
    displayEl.textContent = "No session";
    return;
  }

  // Load from Netlify Function, but only update if valid
  fetch(`/.netlify/functions/getSession?id=${encodeURIComponent(sessionId)}`)
    .then((res) => res.ok ? res.json() : Promise.reject(res.status))
    .then((data) => {
      if (data && data.session_number) {
        if (data.session_id) localStorage.setItem("session_id", data.session_id);
        localStorage.setItem("session_number", data.session_number);
        displayEl.textContent = `Session: ${data.session_number}`;
      } else if (!cachedNum) {
        displayEl.textContent = "Session not found";
      }
    })
    .catch((err) => {
      console.error("Error loading session:", err);
      if (!cachedNum) displayEl.textContent = "Error";
    });
})();
</script>
