<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeShareZ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-container" id="app-root"></div>

  <script type="module">
    // CORRECT: Import the function from script.js
    import { initTutorialOverlay } from './script.js';
    import SessionManager from './sessionManager.js';

    const components = [
      "top-bar", "funded-feed", "hot-feed",
      "main-rotator", "tutorial-overlay", "footer"
    ];

    async function initializeApp() {
      // Load the HTML from the components folder
      const root = document.getElementById("app-root");
      try {
        const responses = await Promise.all(
          components.map(name => fetch(`components/${name}.html`))
        );
        for(const res of responses) {
          if (!res.ok) throw new Error(`Import failed: ${res.url}`);
          const html = await res.text();
          // Use insertAdjacentHTML which is safer than innerHTML for this.
          root.insertAdjacentHTML('beforeend', html);
        }
      } catch (error) {
        console.error("Failed to import required HTML.", error);
        return;
      }

      // Handle the session display logic
      const sessionData = await SessionManager.getOrCreateSession();
      const sessionDisplayElement = document.getElementById("sessionDisplay");
      if (sessionDisplayElement) {
        if (sessionData && sessionData.session_number) {
          sessionDisplayElement.textContent = `Session ID = TSZ ${sessionData.session_number}`;
        } else {
          sessionDisplayElement.textContent = "Error: Could not get session";
        }
      }
      
      // CORRECT: Now that the HTML is loaded, call the function
      // from script.js to make the buttons work.
      initTutorialOverlay();
    }

    initializeApp();
  </script>
</body>
</html>
